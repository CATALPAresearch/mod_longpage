define(["core/ajax"],(function(t){return function(e,o,n){this.utils=e,this.courseid=o,this.name="log_page",this.options=e.mergeObjects({outputType:1,prefix:"",loggerServiceUrl:null,loggerServiceParams:{data:{}},context:"default-context"},n),this.ip="",this.add=function(t,e){if("string"!=typeof e){var o={utc:this.getLogTime().utc,location:{host:window.location.host,pathname:window.location.href,hash:window.location.hash,tabId:"APLE-MOODLE"===window.name.split("=")[0]?window.name.split("=")[1]:"unknown"},context:this.options.context,action:t,value:e,userAgent:{cpu:navigator.oscpu,platform:navigator.platform,engine:navigator.product,browser:navigator.appCodeName,browserVersion:navigator.appVersion,userAgent:navigator.userAgent.replace(/,/gm,";"),screenHeight:screen.height,screenWidth:screen.width}};this.output(o)}else console.log("warning: uncaptured log entry: "+e)},this.validate=function(t){return t},this.getLogTime=function(){var t=new Date,e=t.getSeconds(),o=t.getMinutes(),n=t.getHours(),i=t.getDate(),a=t.getMonth()+1,s=t.getFullYear();return{utc:t.getTime(),date:s+"-"+(a<=9?"0"+a:a)+"-"+(i<=9?"0"+i:i),time:(n<=9?"0"+n:n)+":"+(o<=9?"0"+o:o)+":"+(e<=9?"0"+e:e)+":"+t.getMilliseconds()}},this.output=function(t){switch(this.options.outputType){case 0:console.log(t);break;case 1:this.sendLog(t)}},this.sendLog=function(e){t.call([{methodname:"mod_page_log",args:{data:{courseid:this.courseid,action:e.action,utc:Math.ceil(e.utc/1e3),entry:JSON.stringify(e)}},done:function(t){},fail:function(t){console.error("fail",t)}}])}}}));