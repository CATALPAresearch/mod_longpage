define(["jquery","core/ajax"],(function(t,e){return function(e,n,i,a){require.config({enforceDefine:!1,baseUrl:M.cfg.wwwroot+"/mod/page/lib/",paths:{elasticlunr:["elasticlunr.min"],lunrde:["lunr.de"],stemmer:["lunr.stemmer.support"]}});new e({el:"#nav-app",data:function(){return{message:"",search:"",filter_assessment:!0,filter_text:!0,content:[]}},created:function(){(this.generateTableOfContent(),this.enableScrollLogging(),this.setupSearch(),this.estimateReadingTime(),"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)&&new IntersectionObserver(t=>{t[0].boundingClientRect.y<0?(document.getElementById("longpage-navbar").classList.add("header-not-at-top"),document.getElementById("table-of-content").classList.add("header-not-at-top")):(document.getElementById("longpage-navbar").classList.remove("header-not-at-top"),document.getElementById("table-of-content").classList.remove("header-not-at-top"))}).observe(document.querySelector("#top-of-site-pixel-anchor"));t(".longpage-citation").click((function(){a.add("citation_view",{citation:t(this).data("content")})})),t(".longpage-footnote").click((function(){a.add("footnote_view",{title:t(this).find("button").data("original-title"),text:t(this).find("button").data("content")})})),t(".longpage-crossref").click((function(){a.add("crossref_follow",{source:t(this).text(),target:t(this).attr("href"),parent:t(this).parent().attr("id")})})),t(".longpage-assignment-link").click((function(){a.add("assignment_open",{target:t(this).attr("href")})}));var e=!1;t(".longpage-toc-toggle").click((function(){e=!e,a.add("toc_toggle",{open:e})})),t(".nav-link-h4").click((function(){a.add("toc_entry_open",{level:"h4",target:t(this).attr("href")})})),t(".nav-link-h3").click((function(){a.add("toc_entry_open",{level:"h3",target:t(this).attr("href")})}))},mounted:function(){},computed:{filteredContent:function(){var t=Object.values(this.content).filter((function(t){return!("assessment"!==t.type||!this.filter_assessment)||!("content"!==t.type||!this.filter_text)}));return Object.values(t).filter((function(t){return""}))}},methods:{estimateReadingTime:function(){var e,n,i,a,o,r,l={de:{cpm:250,variance:50}};t(".longpage-container h2").after(t('<span class="longpage-reading-time-estimation"></span>').text((e=t(".longpage-container").text(),n="de",i=t(".longpage-container").find("img").length,a=e.match(/([\s]+)/g).length,o=l[n],r=Math.ceil(a/(o.cpm-o.variance)+.3*i),Math.ceil(a/(o.cpm+o.variance)+.3*i)+"-"+r+" Minuten")))},generateTableOfContent:function(){var e=t(),n=t(),i=t(),a=0,o=0;t(".longpage-container h3, .longpage-container h4").each((function(){if(t(this).is("h3")){t(this).attr("id","xh3item-"+a),i="<li class='nav-item'><a class='nav-link nav-link-h3' data-toggle='collapse' data-parent='#tocList' data-target='#h3item-"+a+"' href='#xh3item-"+a+"'>"+t(this).text()+"</a></li>",n=t("<ul></ul>").addClass("nav flex-column ml-3"),e=t(i),t(".nav-link-h3").click((function(e){var n=t(this).attr("href");window.location.href=window.location.href.split("#")[0]+n}));var r=t("<div></div>").attr("id","h3item-"+a).addClass("collapse").append(n);e.append(r),e.appendTo("#tocList"),a++}else t(this).is("h4")&&(t(this).attr("id","h4item-"+o),i="<li class='nav-item'><a class='nav-link nav-link-h4' href='#h4item-"+o+"'>"+t(this).text()+"</a></li>",n.append(i),o++)}))},enableScrollLogging:function(){if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){var e,n,i=document.querySelector(".longpage-container"),o=document.documentElement.scrollHeight-window.innerHeight,r=document.documentElement.scrollWidth-window.innerWidth;if(getComputedStyle){var l=getComputedStyle(i);e=parseFloat(l.paddingTop)+parseFloat(l.paddingBottom),n=parseFloat(l.paddingLeft)+parseFloat(l.paddingRight)}var c=i.clientHeight-e,s=i.clientWidth-n,d=0,g=0,h=new IntersectionObserver((function(t){for(var e of(t[0].boundingClientRect.y<0?document.getElementById("tocList").classList.add("scrollDown"):document.getElementById("tocList").classList.remove("scrollDown"),t))if(void 0===e.isVisible&&(e.isVisible=!0),e.isIntersecting&&e.isVisible){var n=new Date;d=window.pageXOffset||(document.documentElement||document.body.parentNode||document.body).scrollRight,g=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop;var i={utc:n.getTime(),relativeTime:e.time,targetID:e.target.id,targetTag:e.target.localName,targetClasses:e.target.className,scrollXDistance:void 0===d?0:d,scrollYDistance:void 0===g?0:g,scrollHeight:o,scrollWidth:r,containerHeight:c,containerWidth:s};a.add("scroll",i)}}),{root:null,rootMargin:"0px",threshold:[1],trackVisibility:!0,delay:100}),p=0;t("p, ul, pre, div.longpage-image-block, div.longpage-assignment, h2, h3").each((function(e,n){""!==t(this).attr("id")&&void 0!==t(this).attr("id")||(t(this).attr("id","paragraph-"+p),p++),h.observe(document.querySelector("#"+t(this).attr("id")))}))}},setupSearch:function(){require(["jquery","elasticlunr","lunrde","stemmer"],(function(t,e,n,i){e.addStopWords(["an","der","die","das"]);var o=e();o.addField("title"),o.addField("body"),o.setRef("id"),t(".longpage-container h2, .longpage-container h3, .longpage-container h4, .longpage-container p, .longpage-container ul, .longpage-container ol, .longpage-container pre").each((function(e,n){o.addDoc({id:e,title:t(n).text(),body:"",link:t(n).attr("id")})})),t(".longpage-container h2, .longpage-container h3, .longpage-container h4, .longpage-container p, .longpage-container ul, .longpage-container ol, .longpage-container pre").each((function(e,n){t(this).is("h2")||t(this).is("h3")||t(this).is("h4")?o.addDoc({id:e,title:t(n).text(),body:"",link:t(n).attr("id")}):(""!==t(n).attr("id")&&void 0!==t(n).attr("id")||t(n).attr("id",Math.ceil(1e3*Math.random())),o.addDoc({id:e,title:"",body:t(n).text(),link:t(n).attr("id")}))})),t("#longpage-search-form").submit((function(t){t.preventDefault()}));var r=function(e){var n=t("#search-string").val();if(""!==n){var i=o.search(String(n),{fields:{title:{boost:2},body:{boost:1}}});a.add("searchterm",{searchterm:n,results:i.kength}),t("#search-results").empty();for(var r=0;r<i.length;r++){var l=t("<li></li>");t("<a></a>").text(""===i[r].doc.title?i[r].doc.body.substr(0,20):i[r].doc.title).attr("href","#"+i[r].doc.link).click((function(){a.add("searchresultselected",{searchterm:n,results:i.kength,selected:i[r].doc.link,title:i[r].doc.title})})).appendTo(l),t("<div></div>").text(i[r].doc.body.substr(0,20)).appendTo(l),l.appendTo("#search-results")}t("#search-results-panel").collapse("show")}};t("#search-full-text").click((function(t){r()})),t("#search-string").on("keypress",(function(t){13===t.which&&r()}))}))},decode:function(t){return t.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")}}})}}));