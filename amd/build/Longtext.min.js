define(["jquery",M.cfg.wwwroot+"/mod/page/amd/src/ReadingTime.js"],(function(e,t){return function(n,i,o,a){require.config({enforceDefine:!1,paths:{elasticlunr:[M.cfg.wwwroot+"/mod/page/lib/build/elasticlunr.min"],lunrde:[M.cfg.wwwroot+"/mod/page/lib/build/lunr.de"],stemmer:[M.cfg.wwwroot+"/mod/page/lib/build/lunr.stemmer.support"]}}),new n({el:"longpage-container",data:function(){return{pagename:"",filter_assessment:!0,filter_text:!0,content:[],showTOC:!1,index:{},search:"",searchResults:"",searchTerm:"",showSearchResults:!1}},components:{ReadingTime:t},mounted:function(){(this.pagename=a,this.enableScrollLogging(),this.setupSearch(),"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)&&new IntersectionObserver(e=>{e[0].boundingClientRect.y<0?document.getElementById("longpage-navbar").classList.add("header-not-at-top"):document.getElementById("longpage-navbar").classList.remove("header-not-at-top")}).observe(document.querySelector("#top-of-site-pixel-anchor"));e(".longpage-citation").click((function(){o.add("citation_view",{citation:e(this).data("content")})})),e(".longpage-footnote").click((function(){o.add("footnote_view",{title:e(this).find("button").data("original-title"),text:e(this).find("button").data("content")})})),e(".longpage-crossref").click((function(){o.add("crossref_follow",{source:e(this).text(),target:e(this).attr("href"),parent:e(this).parent().attr("id")})})),e(".longpage-assignment-link").click((function(){o.add("assignment_open",{target:e(this).attr("href")})}));var t=!1;e(".longpage-toc-toggle").click((function(){t=!t,o.add("toc_toggle",{open:t})})),e(".nav-link-h4").click((function(){o.add("toc_entry_open",{level:"h4",target:e(this).attr("href")})})),e(".nav-link-h3").click((function(){o.add("toc_entry_open",{level:"h3",target:e(this).attr("href")})}))},computed:{filteredContent:function(){var e=Object.values(this.content).filter((function(e){return!("assessment"!==e.type||!this.filter_assessment)||!("content"!==e.type||!this.filter_text)}));return Object.values(e).filter((function(e){return""}))}},methods:{generateTableOfContent:function(){var t={},n={},i={},o=0,a=0;e(".longpage-container h3, .longpage-container h4").each((function(){if(console.log(22),e(this).is("h3")){e(this).attr("id","xh3item-"+o),i="<li class='nav-item'><a class='nav-link nav-link-h3' data-parent='#toclist' data-toggle='collapse' data-target='#h3item-"+o+"' href='#xh3item-"+o+"'>"+e(this).text()+"</a></li>",n=e("<ul></ul>").addClass("nav flex-column ml-3"),t=e(i),e(".nav-link-h3").click((function(t){var n=e(this).attr("href");window.location.href=window.location.href.split("#")[0]+n;var i=window.scrollY||window.scrollTop||document.getElementsByTagName("html")[0].scrollTop||window.pageYOffset;window.scroll({top:i-30,left:0,behavior:"smooth"}),console.log(i,n,window.scrollY)}));var l=e("<div></div>").attr("id","h3item-"+o).addClass("collapse").append(n);t.append(l),window.toclist?t.appendTo("#toclist"):console.log("Could not find toclist"),o++}else e(this).is("h4")&&(e(this).attr("id","h4item-"+a),i="<li class='nav-item'><a class='nav-link nav-link-h4' href='#h4item-"+a+"'>"+e(this).text()+"</a></li>",n.append(i),a++)}))},displayTOC:function(){this.showTOC=!0;let e=this;n.nextTick((function(){e.generateTableOfContent()}))},hideTOC:function(){this.showTOC=!1},enableScrollLogging:function(){if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype&&document.querySelector(".longpage-container")){var t,n,i=document.querySelector(".longpage-container"),a=document.documentElement.scrollHeight-window.innerHeight,l=document.documentElement.scrollWidth-window.innerWidth;if(window.getComputedStyle&&i){var s=window.getComputedStyle(i);t=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom),n=parseFloat(s.paddingLeft)+parseFloat(s.paddingRight)}var r=i.clientHeight-t,c=i.clientWidth-n,d=0,h=0,g=new IntersectionObserver((function(e){for(var t of(e[0].boundingClientRect.y,e))if(void 0===t.isVisible&&(t.isVisible=!0),t.isIntersecting&&t.isVisible){var n=new Date;d=window.pageXOffset||(document.documentElement||document.body.parentNode||document.body).scrollRight,h=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop;var i={utc:n.getTime(),relativeTime:t.time,targetID:t.target.id,targetTag:t.target.localName,targetClasses:t.target.className,scrollXDistance:void 0===d?0:d,scrollYDistance:void 0===h?0:h,scrollHeight:a,scrollWidth:l,containerHeight:r,containerWidth:c};o.add("scroll",i)}}),{root:null,rootMargin:"0px",threshold:[1],trackVisibility:!0,delay:100}),u=0;e("p, ul, pre, div.longpage-image-block, div.longpage-assignment, h2, h3").each((function(t,n){""!==e(this).attr("id")&&void 0!==e(this).attr("id")||(e(this).attr("id","paragraph-"+u),u++),g.observe(document.querySelector("#"+e(this).attr("id")))}))}},setupSearch:function(){let e=this;require(["jquery","elasticlunr","lunrde","stemmer"],(function(t,n,i,o){n.addStopWords(["an","der","die","das"]),e.index=n(),e.index.addField("title"),e.index.addField("body"),e.index.setRef("id"),t(".longpage-container h2, .longpage-container h3, .longpage-container h4, .longpage-container div, .longpage-container p, .longpage-container ul, .longpage-container ol, .longpage-container pre").each((function(n,i){e.index.addDoc({id:n,title:t(i).text(),body:"",link:t(i).attr("id")})})),t(".longpage-container h2, .longpage-container h3, .longpage-container h4, .longpage-container div, .longpage-container p, .longpage-container ul, .longpage-container ol, .longpage-container pre").each((function(n,i){t(this).is("h2")||t(this).is("h3")||t(this).is("h4")?e.index.addDoc({id:n,title:t(i).text(),body:"",link:t(i).attr("id")}):(""!==t(i).attr("id")&&void 0!==t(i).attr("id")||t(i).attr("id",Math.ceil(1e3*Math.random())),e.index.addDoc({id:n,title:"",body:t(i).text(),link:t(i).attr("id")}))}))}))},doFulltextSearch:function(e){let t=this;this.showSearchResults=!0,""!==this.searchTerm&&(this.searchResults=this.index.search(String(this.searchTerm),{fields:{title:{boost:2},body:{boost:1}}}),this.searchResults=this.searchResults.map((function(e){let n=e.doc.body.indexOf(t.searchTerm);return e.doc.short=n>0?"... "+e.doc.body.substr(n-20>0?n-20:0,40):t.searchTerm,e})),o.add("searchterm",{searchterm:this.searchTerm,results:this.searchResults.length})),e.preventDefault()},searchResultClick:function(e){this.hideSearchResults(),o.add("searchresultselected",{searchterm:this.term,results:this.searchResults.length,selected:e.link,title:e.title})},hideSearchResults:function(){this.showSearchResults=!1},decode:function(e){return e.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")}},template:'\n                <div>\n                    <nav id="longpage-navbar" class="navbar-expand navbar-light bg-light py-2 mx-0 pl-1 pr-2">\n                        <div class="row w-100 px-0 mx-0">\n                            <span class="title-toc col-4 col-sm-4 col-xs-12">\n                                <a class="navbar-brand">{{ pagename }}</a>\n                            </span>\n                            <div class="col-4 col-sm-4 col-xs-4">\n                                <button @click="displayTOC" class="btn btn-link longpage-toc-toggle longpage-nav-btn" type="button" title="Inhaltsverzeichnis">\n                                    <i class="fa fa-list d-xs-inline d-lg-none"></i>\n                                    <span class="d-none d-lg-inline" style="text-transform: capitalize;">Inhaltsverzeichnis</span>\n                                </button>\n                            </div>\n                            <div class="form-inline col-4 col-sm-4 col-xs-8 mb-1 px-0 mx-0">\n                                <input v-model="searchTerm" v-on:keyup.enter="doFulltextSearch" id="search-string" class="form-control form-control-sm mr-sm-2 d-inline w-50 d-flex ml-auto" type="search" placeholder="Suchen" aria-label="Search">\n                                <button @click="doFulltextSearch" id="search-full-text" class="btn btn-light btn-sm d-inline mr-0" type="button"><i class="fa fa-search"></i></button>\n                            </div>\n                        </div>\n                        <div v-if="showSearchResults" class="row w-100 px-0 mx-0" style="z-index:3000;">\n                            <div class="col-9 d-inline d-xs-none"></div>\n                            <div class="col-3 col-xs-12 p-3 bg-light" style="max-height:80vh; overflow:auto">\n                                <button type="button" class="close ml-auto align-self-center d-block" aria-label="Close" v-on:click="hideSearchResults">\n                                    <span aria-hidden="true">&times;</span>\n                                </button><br>\n                                <div class="mb-2">{{ searchResults.length }} Suchtreffer f√ºr \'{{ searchTerm }}\':</div>\n                                <ul id="search-results" class="list-unstyled">\n                                    <li class="mb-2" v-for="res in searchResults" v-if="res.doc.short.length > 0">\n                                        <a \n                                            class="underline"\n                                            style="word-wrap: break-word; color: #004C97 !important;"\n                                            :href="\'#\'+res.doc.link"\n                                            @click="searchResultClick(res.doc)"\n                                            >\n                                            {{ res.doc.short }}\n                                            </a>\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </nav>\n                    <div v-if="showTOC" class="row px-0 m-0" id="table-of-content" style="z-index:3000;">\n                        <div class="bg-light col-4 col-lg-4 col-xs-12 p-3 m-0" style="max-height:80vh; overflow:auto">\n                            <button type="button" class="close ml-auto align-self-center d-block" aria-label="Close" v-on:click="hideTOC">\n                                <span aria-hidden="true">&times;</span>\n                            </button><br>\n                            <ul id="toclist" class="nav-pills"></ul>\n                        </div>\n                    </div>\n                    <ReadingTime></ReadingTime>\n                </div>\n            '})}}));