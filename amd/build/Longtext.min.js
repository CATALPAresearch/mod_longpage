define(["jquery",M.cfg.wwwroot+"/mod/page/amd/src/ReadingTime.js",M.cfg.wwwroot+"/mod/page/amd/src/TableOfContent.js"],(function(t,e,n){return function(a,i,o,s){new a({el:"longpage-container",data:function(){return{pagename:"",log:{},tabContentVisible:!1,filter_assessment:!0,filter_text:!0,content:[]}},components:{TableOfContent:n,ReadingTime:e},mounted:function(){(console.log("mounted"),this.log=o,this.pagename=s,this.enableScrollLogging(),this.visualizeReadingProgress(),"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)&&new IntersectionObserver(t=>{t[0].boundingClientRect.y<0?document.getElementById("longpage-navbar").classList.add("header-not-at-top"):document.getElementById("longpage-navbar").classList.remove("header-not-at-top")}).observe(document.querySelector("#top-of-site-pixel-anchor"));t(".longpage-citation").click((function(){o.add("citation_view",{citation:t(this).data("content")})})),t(".longpage-footnote").click((function(){o.add("footnote_view",{title:t(this).find("button").data("original-title"),text:t(this).find("button").data("content")})})),t(".longpage-crossref").click((function(){o.add("crossref_follow",{source:t(this).text(),target:t(this).attr("href"),parent:t(this).parent().attr("id")})})),t(".longpage-assignment-link").click((function(){o.add("assignment_open",{target:t(this).attr("href")})}))},computed:{filteredContent:function(){var t=Object.values(this.content).filter((function(t){return!("assessment"!==t.type||!this.filter_assessment)||!("content"!==t.type||!this.filter_text)}));return Object.values(t).filter((function(t){return""}))}},methods:{showTabContent(){this.tabContentVisible=!0},hideTabContent(){this.tabContentVisible=!1},enableScrollLogging:function(){if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype&&document.querySelector(".longpage-container")){var e,n,a=document.querySelector(".longpage-container"),i=document.documentElement.scrollHeight-window.innerHeight,s=document.documentElement.scrollWidth-window.innerWidth;if(window.getComputedStyle&&a){var l=window.getComputedStyle(a);e=parseFloat(l.paddingTop)+parseFloat(l.paddingBottom),n=parseFloat(l.paddingLeft)+parseFloat(l.paddingRight)}var r=a.clientHeight-e,c=a.clientWidth-n,d=0,b=0,g=new IntersectionObserver((function(t){for(var e of(t[0].boundingClientRect.y,t))if(void 0===e.isVisible&&(e.isVisible=!0),e.isIntersecting&&e.isVisible){var n=new Date;d=window.pageXOffset||(document.documentElement||document.body.parentNode||document.body).scrollRight,b=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop;var a={utc:n.getTime(),relativeTime:e.time,targetID:e.target.id,targetTag:e.target.localName,targetClasses:e.target.className,scrollXDistance:void 0===d?0:d,scrollYDistance:void 0===b?0:b,scrollHeight:i,scrollWidth:s,containerHeight:r,containerWidth:c};o.add("scroll",a)}}),{root:null,rootMargin:"0px",threshold:[1],trackVisibility:!0,delay:100}),p=0;t("p, ul, pre, div.longpage-image-block, div.longpage-assignment, h2, h3").each((function(e,n){""!==t(this).attr("id")&&void 0!==t(this).attr("id")||(t(this).attr("id","paragraph-"+p).addClass("longpage-paragraph"),p++),g.observe(document.querySelector("#"+t(this).attr("id")))}))}},visualizeReadingProgress:function(){for(var e=1;e<460;e++)t("#paragraph-"+e).append(t("<span></span>").addClass("reading-progress progress-"+Math.ceil(5*Math.random())))},decode:function(t){return t.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")}},template:'\n                <div>\n                    <nav id="longpage-navbar" class="navbar-expand navbar-light bg-light py-2 mx-0 pl-1 pr-2">\n                        <div class="row w-100 px-0 mx-0">\n                            <span class="title-toc col-4 col-sm-4 col-xs-12">\n                                <a class="navbar-brand">{{ pagename }}</a>\n                            </span>\n                            <div class="col-4 col-sm-4 col-xs-4">\n                                <ul class="nav nav-tabs" id="longpageFeatures" role="tablist">\n                                    <li class="nav-item">\n                                        <a class="nav-link" id="toc-tab" data-toggle="tab" href="#tableofcontent" role="tab" aria-controls="tableofcontents" aria-selected="false" @click="showTabContent()">\n                                            <i class="fa fa-list"></i>\n                                        </a>\n                                    </li>\n                                    <li class="nav-item">\n                                        <a class="nav-link" id="concepts-tab" data-toggle="tab" href="#concepts" role="tab" aria-controls="concepts" aria-selected="false" @click="showTabContent()">\n                                            <i class="fa fa-map"></i>\n                                        </a>\n                                    </li>\n                                    <li class="nav-item">\n                                        <a class="nav-link" id="tests-tab" data-toggle="tab" href="#tests" role="tab" aria-controls="tests" aria-selected="false" @click="showTabContent()">\n                                            <i class="fa fa-check"></i>\n                                        </a>\n                                    </li>\n                                    <li class="nav-item">\n                                        <a class="nav-link" id="bookmarks-tab" data-toggle="tab" href="#bookmarks" role="tab" aria-controls="bookmarkss" aria-selected="false" @click="showTabContent()">\n                                            <i class="fa fa-bookmark"></i>\n                                        </a>\n                                    </li>\n                                    <li class="nav-item">\n                                        <a class="nav-link" id="annotations-tab" data-toggle="tab" href="#annotations" role="tab" aria-controls="annotations" aria-selected="false" @click="showTabContent()">\n                                            <i class="fa fa-pencil"></i>\n                                        </a>\n                                    </li>\n                                    <li class="nav-item">\n                                        <a class="nav-link" id="search-tab" data-toggle="tab" href="#search" role="tab" aria-controls="search" aria-selected="false" @click="showTabContent()">\n                                            <i class="fa fa-search"></i>\n                                        </a>\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- --\x3e\n                        <div :style="{visibility: tabContentVisible ? \'visible\' : \'hidden\'}" class="tab-content" id="myTabContent">\n                            <div class="tab-pane fade" id="tableofcontent" role="tabpanel" aria-labelledby="toc-tab">\n                                <TableOfContent @hideTabContent=\'hideTabContent\'></TableOfContent>\n                            </div>\n                            <div class="tab-pane fade" id="concepts" role="tabpanel" aria-labelledby="toc-tab">\n                                Concepts\n                                <button type="button" class="close ml-auto align-self-center d-block" aria-label="Close" v-on:click="hideTabContent()">\n                                    <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>\n                            <div class="tab-pane fade" id="tests" role="tabpanel" aria-labelledby="toc-tab">\n                                Tests\n                                <button type="button" class="close ml-auto align-self-center d-block" aria-label="Close" v-on:click="hideTabContent()">\n                                    <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>\n                            <div class="tab-pane fade" id="bookmarks" role="tabpanel" aria-labelledby="toc-tab">\n                                Bookmarks\n                                <button type="button" class="close ml-auto align-self-center d-block" aria-label="Close" v-on:click="hideTabContent()">\n                                    <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>\n                            <div class="tab-pane fade" id="annotations" role="tabpanel" aria-labelledby="toc-tab">\n                                Annotations\n                                <button type="button" class="close ml-auto align-self-center d-block" aria-label="Close" v-on:click="hideTabContent()">\n                                    <span aria-hidden="true">&times;</span>\n                                </button>\n                            </div>\n                            <div class="search-pane fade" id="search" role="tabpanel" aria-labelledby="search-tab">\n                                \x3c!-- <Search \n                                    @hideTabContent=\'hideTabContent\'\n                                    :log=\'log\'\n                                    ></Search>--\x3e\n                            </div>\n                        </div>\n\n                        \x3c!-- --\x3e\n                        \n                    </nav>\n                    \n                    \n                </div>\n            '})}}));