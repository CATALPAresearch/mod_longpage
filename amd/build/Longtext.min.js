define(["jquery","core/ajax"],(function(e,t){return function(t,n,i,a,o){require.config({enforceDefine:!1,baseUrl:M.cfg.wwwroot+"/mod/page/lib/",paths:{elasticlunr:["elasticlunr.min"],lunrde:["lunr.de"],stemmer:["lunr.stemmer.support"]}});new t({el:"#nav-app",data:function(){return{pagename:"",message:"",search:"",searchResults:"",filter_assessment:!0,filter_text:!0,content:[],index:{},searchTerm:""}},created:function(){(this.pagename=o,this.generateTableOfContent(),this.enableScrollLogging(),this.setupSearch(),this.estimateReadingTime(),"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)&&new IntersectionObserver(e=>{e[0].boundingClientRect.y<0?(document.getElementById("longpage-navbar").classList.add("header-not-at-top"),document.getElementById("table-of-content").classList.add("header-not-at-top")):(document.getElementById("longpage-navbar").classList.remove("header-not-at-top"),document.getElementById("table-of-content").classList.remove("header-not-at-top"))}).observe(document.querySelector("#top-of-site-pixel-anchor"));e(".longpage-citation").click((function(){a.add("citation_view",{citation:e(this).data("content")})})),e(".longpage-footnote").click((function(){a.add("footnote_view",{title:e(this).find("button").data("original-title"),text:e(this).find("button").data("content")})})),e(".longpage-crossref").click((function(){a.add("crossref_follow",{source:e(this).text(),target:e(this).attr("href"),parent:e(this).parent().attr("id")})})),e(".longpage-assignment-link").click((function(){a.add("assignment_open",{target:e(this).attr("href")})}));var t=!1;e(".longpage-toc-toggle").click((function(){t=!t,a.add("toc_toggle",{open:t})})),e(".nav-link-h4").click((function(){a.add("toc_entry_open",{level:"h4",target:e(this).attr("href")})})),e(".nav-link-h3").click((function(){a.add("toc_entry_open",{level:"h3",target:e(this).attr("href")})}))},computed:{filteredContent:function(){var e=Object.values(this.content).filter((function(e){return!("assessment"!==e.type||!this.filter_assessment)||!("content"!==e.type||!this.filter_text)}));return Object.values(e).filter((function(e){return""}))}},methods:{estimateReadingTime:function(){var t={de:{cpm:250,variance:50}},n=function(e,n,i){var a=e.match(/([\s]+)/g).length,o=t[n],s=Math.ceil(a/(o.cpm-o.variance)+.3*i);return Math.ceil(a/(o.cpm+o.variance)+.3*i)+"-"+s+" Minuten"};e("h2").each((function(t,n){e(this).nextUntil("h2").addBack().wrapAll('<span id="con-'+t+'" class="boxContainer-h2"></span>')})),e(".boxContainer-h2").each((function(t,i){e(this).css("border","solid blue 1px"),e(this).find("h2").first().after(e('<span class="longpage-reading-time-estimation"></span>').text("Geschätzte Lesezeit "+n(e(i).text(),"de",e(i).find("img").length)))})),e("h3").each((function(t,n){e(this).nextUntil("h3").addBack().wrapAll('<span id="con-'+t+'" class="boxContainer-h3"></span>')})),e(".boxContainer-h3").each((function(t,i){e(this).css("border","solid green 1px"),e(this).find("h3").first().after(e('<span class="longpage-reading-time-estimation"></span>').text("Geschätzte Lesezeit "+n(e(i).text(),"de",e(i).find("img").length)))}))},generateTableOfContent:function(){var t=e(),n=e(),i=e(),a=0,o=0;e(".longpage-container h3, .longpage-container h4").each((function(){if(e(this).is("h3")){e(this).attr("id","xh3item-"+a),i="<li class='nav-item'><a class='nav-link nav-link-h3' data-toggle='collapse' data-parent='#tocList' data-target='#h3item-"+a+"' href='#xh3item-"+a+"'>"+e(this).text()+"</a></li>",n=e("<ul></ul>").addClass("nav flex-column ml-3"),t=e(i),e(".nav-link-h3").click((function(t){var n=e(this).attr("href");window.location.href=window.location.href.split("#")[0]+n}));var s=e("<div></div>").attr("id","h3item-"+a).addClass("collapse").append(n);t.append(s),t.appendTo("#tocList"),a++}else e(this).is("h4")&&(e(this).attr("id","h4item-"+o),i="<li class='nav-item'><a class='nav-link nav-link-h4' href='#h4item-"+o+"'>"+e(this).text()+"</a></li>",n.append(i),o++)}))},enableScrollLogging:function(){if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){var t,n,i=document.querySelector(".longpage-container"),o=document.documentElement.scrollHeight-window.innerHeight,s=document.documentElement.scrollWidth-window.innerWidth;if(getComputedStyle){var r=getComputedStyle(i);t=parseFloat(r.paddingTop)+parseFloat(r.paddingBottom),n=parseFloat(r.paddingLeft)+parseFloat(r.paddingRight)}var l=i.clientHeight-t,c=i.clientWidth-n,d=0,h=0,g=new IntersectionObserver((function(e){for(var t of(e[0].boundingClientRect.y<0?document.getElementById("tocList").classList.add("scrollDown"):document.getElementById("tocList").classList.remove("scrollDown"),e))if(void 0===t.isVisible&&(t.isVisible=!0),t.isIntersecting&&t.isVisible){var n=new Date;d=window.pageXOffset||(document.documentElement||document.body.parentNode||document.body).scrollRight,h=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop;var i={utc:n.getTime(),relativeTime:t.time,targetID:t.target.id,targetTag:t.target.localName,targetClasses:t.target.className,scrollXDistance:void 0===d?0:d,scrollYDistance:void 0===h?0:h,scrollHeight:o,scrollWidth:s,containerHeight:l,containerWidth:c};a.add("scroll",i)}}),{root:null,rootMargin:"0px",threshold:[1],trackVisibility:!0,delay:100}),p=0;e("p, ul, pre, div.longpage-image-block, div.longpage-assignment, h2, h3").each((function(t,n){""!==e(this).attr("id")&&void 0!==e(this).attr("id")||(e(this).attr("id","paragraph-"+p),p++),g.observe(document.querySelector("#"+e(this).attr("id")))}))}},setupSearch:function(){let e=this;require(["jquery","elasticlunr","lunrde","stemmer"],(function(t,n,i,a){n.addStopWords(["an","der","die","das"]),e.index=n(),e.index.addField("title"),e.index.addField("body"),e.index.setRef("id"),t(".longpage-container h2, .longpage-container h3, .longpage-container h4, .longpage-container p, .longpage-container ul, .longpage-container ol, .longpage-container pre").each((function(n,i){e.index.addDoc({id:n,title:t(i).text(),body:"",link:t(i).attr("id")})})),t(".longpage-container h2, .longpage-container h3, .longpage-container h4, .longpage-container p, .longpage-container ul, .longpage-container ol, .longpage-container pre").each((function(n,i){t(this).is("h2")||t(this).is("h3")||t(this).is("h4")?e.index.addDoc({id:n,title:t(i).text(),body:"",link:t(i).attr("id")}):(""!==t(i).attr("id")&&void 0!==t(i).attr("id")||t(i).attr("id",Math.ceil(1e3*Math.random())),e.index.addDoc({id:n,title:"",body:t(i).text(),link:t(i).attr("id")}))}))}))},doFulltextSearch:function(e){""!==this.searchTerm&&(this.searchResults=this.index.search(String(this.searchTerm),{fields:{title:{boost:2},body:{boost:1}}}),a.add("searchterm",{searchterm:this.searchTerm,results:this.searchResults.length}))},decode:function(e){return e.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"")}},el:"longpage-container",template:'\n                <div>\n                    <nav id="longpage-navbar" class="page-navbar navbar navbar-light bg-light py-2 mx-0 px-2">\n                        <div class="row w-100 px-0">\n                            <span class="title-toc col-8">\n                                <a class="navbar-brand">{{ pagename }}</a>\n                                <a class="btn btn-link longpage-toc-toggle longpage-nav-btn" data-toggle="collapse" role="button" href="#table-of-content">Inhaltsverzeichnis</a>\n                            </span>\n                            <form id="longpage-search-formX" class="form-inline col-4 mb-1">\n                                <input v-model="searchTerm" id="search-string" class="form-control mr-sm-2 d-inline" type="search" placeholder="Suche" aria-label="Search">\n                                <button @click="doFulltextSearch" id="search-full-text" class="btn btn-outline-success d-inline" type="button">Suchen</button>\n                            </form>\n                        </div>\n                        <div v-if="searchTerm.length !== 0" class="row w-100 px-0 mx-0" id="search-results-panel">\n                            <div class="col-9"></div>\n                            <div class="col-3 p-1" style="background-color:#ddd;">\n                                <ul id="search-results" class="list-unstyled">\n                                    <li class="mb-2" v-for="res in searchResults">\n                                        <a class="btn btn-link word-wrap"\n                                            :href="\'#\'+res.doc.link">{{ res.doc.body.title }} {{ res.doc.body.substr(res.doc.body.indexOf(searchTerm)-20, res.doc.body.indexOf(searchTerm)+20) }}</a>\n                                        \x3c!--\n                                        log.add(\'searchresultselected\', { searchterm: term, results: res.kength, selected: res[i].doc.link, title: res[i].doc.title });\n                                        --\x3e\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </nav>\n                    <div class="collapse" id="table-of-content">\n                        <ul id="tocList" class="nav-pills"></ul>\n                    </div>\n                </div>\n            '})}}));